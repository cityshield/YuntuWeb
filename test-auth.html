<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæµ‹è¯• - ç™»å½•æ³¨å†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 40px 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 40px;
            color: #4a9eff;
        }
        .section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }
        h2 {
            margin-bottom: 20px;
            color: #4a9eff;
            font-size: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
            font-size: 14px;
        }
        input {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }
        input:focus {
            outline: none;
            border-color: #4a9eff;
        }
        button {
            width: 100%;
            padding: 12px 20px;
            background: #4a9eff;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #3a8eef;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 6px;
            border-left: 4px solid #4a9eff;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            display: none;
        }
        .result.show {
            display: block;
        }
        .result.success {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        .result.error {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        .info {
            background: rgba(74, 158, 255, 0.1);
            border: 1px solid #4a9eff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .info h3 {
            color: #4a9eff;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info p {
            color: #b0b0b0;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        .info code {
            background: #1a1a1a;
            padding: 2px 8px;
            border-radius: 4px;
            color: #4a9eff;
            font-family: 'Courier New', monospace;
        }
        .sms-group {
            display: flex;
            gap: 12px;
        }
        .sms-group input {
            flex: 1;
        }
        .sms-group button {
            width: auto;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å¿«é€Ÿæµ‹è¯• - ç™»å½•æ³¨å†Œ</h1>

        <div class="info">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <p>1. å…ˆæ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦å·ï¼ˆéªŒè¯ç å›ºå®šä¸º <code>123456</code>ï¼‰</p>
            <p>2. ç„¶åä½¿ç”¨æ³¨å†Œçš„æ‰‹æœºå·å’Œå¯†ç ç™»å½•</p>
            <p>3. ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨è·³è½¬åˆ° <code>console.html</code>ï¼ˆæ§åˆ¶å°ï¼‰æˆ– <code>files.html</code>ï¼ˆæ–‡ä»¶ç®¡ç†ï¼‰</p>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <div class="section">
            <h2>ğŸ“ æ³¨å†Œæ–°ç”¨æˆ·</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label>æ‰‹æœºå·</label>
                    <input type="tel" id="regPhone" placeholder="13888888888" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰</label>
                    <input type="password" id="regPassword" placeholder="è¾“å…¥å¯†ç " required>
                </div>
                <div class="form-group">
                    <label>çŸ­ä¿¡éªŒè¯ç </label>
                    <div class="sms-group">
                        <input type="text" id="regCode" placeholder="123456" required maxlength="6">
                        <button type="button" id="sendCodeBtn">å‘é€éªŒè¯ç </button>
                    </div>
                </div>
                <button type="submit">æ³¨å†Œ</button>
            </form>
            <div class="result" id="regResult"></div>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <div class="section">
            <h2>ğŸ” ç”¨æˆ·ç™»å½•</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>æ‰‹æœºå·</label>
                    <input type="tel" id="loginPhone" placeholder="13888888888" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit">ç™»å½•</button>
            </form>
            <div class="result" id="loginResult"></div>
        </div>

        <!-- è·³è½¬é€‰é¡¹ -->
        <div class="section">
            <h2>ğŸš€ å¿«é€Ÿè·³è½¬</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <button onclick="window.location.href='console.html'">æ§åˆ¶å°</button>
                <button onclick="window.location.href='files.html'">æ–‡ä»¶ç®¡ç†</button>
            </div>
        </div>
    </div>

    <script src="scripts/api-config.js"></script>
    <script>
        let countdown = 0;
        let timer = null;

        // å‘é€éªŒè¯ç 
        document.getElementById('sendCodeBtn').addEventListener('click', async function() {
            const phone = document.getElementById('regPhone').value.trim();
            const btn = this;

            if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                showResult('regResult', 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·', false);
                return;
            }

            btn.disabled = true;

            try {
                const response = await apiClient.sendVerificationCode(phone);
                showResult('regResult', 'éªŒè¯ç å·²å‘é€ï¼ï¼ˆå¼€å‘ç¯å¢ƒå›ºå®šä¸º 123456ï¼‰', true);

                // å€’è®¡æ—¶
                countdown = 60;
                timer = setInterval(() => {
                    countdown--;
                    btn.textContent = `${countdown}s`;
                    if (countdown <= 0) {
                        clearInterval(timer);
                        btn.textContent = 'å‘é€éªŒè¯ç ';
                        btn.disabled = false;
                    }
                }, 1000);

            } catch (error) {
                showResult('regResult', 'å‘é€å¤±è´¥: ' + error.message, false);
                btn.disabled = false;
            }
        });

        // æ³¨å†Œ
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const phone = document.getElementById('regPhone').value.trim();
            const password = document.getElementById('regPassword').value;
            const code = document.getElementById('regCode').value.trim();
            const submitBtn = e.target.querySelector('button[type="submit"]');

            if (password.length < 6) {
                showResult('regResult', 'å¯†ç é•¿åº¦è‡³å°‘6ä½', false);
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'æ³¨å†Œä¸­...';

            try {
                const response = await apiClient.register({
                    username: 'user_' + phone,  // ä½¿ç”¨ user_æ‰‹æœºå· ä½œä¸ºç”¨æˆ·å
                    phone: phone,
                    verification_code: code,
                    password: password
                });

                showResult('regResult', `âœ… æ³¨å†ŒæˆåŠŸï¼\nç”¨æˆ·å: ${response.user.username}\næ‰‹æœºå·: ${response.user.phone}\nTokenå·²ä¿å­˜`, true);

                // æ¸…ç©ºè¡¨å•
                this.reset();

                // 2ç§’åè·³è½¬
                setTimeout(() => {
                    window.location.href = 'console.html';
                }, 2000);

            } catch (error) {
                showResult('regResult', 'âŒ æ³¨å†Œå¤±è´¥: ' + error.message, false);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'æ³¨å†Œ';
            }
        });

        // ç™»å½•
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            submitBtn.disabled = true;
            submitBtn.textContent = 'ç™»å½•ä¸­...';

            try {
                const response = await apiClient.login({
                    username: phone,  // æ”¯æŒä½¿ç”¨æ‰‹æœºå·ç™»å½•
                    password: password
                });

                showResult('loginResult', `âœ… ç™»å½•æˆåŠŸï¼\nç”¨æˆ·å: ${response.user.username}\næ‰‹æœºå·: ${response.user.phone}\nTokenå·²ä¿å­˜\n\næ­£åœ¨è·³è½¬...`, true);

                // æ¸…ç©ºè¡¨å•
                this.reset();

                // 2ç§’åè·³è½¬
                setTimeout(() => {
                    window.location.href = 'files.html';
                }, 2000);

            } catch (error) {
                showResult('loginResult', 'âŒ ç™»å½•å¤±è´¥: ' + error.message, false);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ç™»å½•';
            }
        });

        function showResult(id, message, success) {
            const result = document.getElementById(id);
            result.textContent = message;
            result.className = 'result show ' + (success ? 'success' : 'error');
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('load', function() {
            if (apiClient.isLoggedIn()) {
                const user = apiClient.getUserInfo();
                if (user) {
                    showResult('loginResult', `âœ… å·²ç™»å½•\nç”¨æˆ·: ${user.username}\næ‰‹æœº: ${user.phone}`, true);
                }
            }
        });
    </script>
</body>
</html>
