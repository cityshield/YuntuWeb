# 文件管理系统测试指南

## 📋 测试环境准备

### 1. 服务状态检查

✅ **前端服务**: http://localhost:5174 （已运行）
✅ **后端服务**: http://localhost:8000 （已运行）
✅ **数据库**: SQLite (`yuntu_test.db`) （已存在）

### 2. 测试账号信息

**已存在的测试账号**:
- **用户名**: `testuser2025`
- **手机号**: `13999999999`
- **密码**: `testpass123`
- **盘符**: 已创建 1 个盘符（默认盘）

---

## 🧪 快速测试流程

### 方法一：使用测试页面（推荐）

1. **打开测试页面**
   ```
   http://localhost:5174/test-auth.html
   ```

2. **直接登录**
   - 手机号: `13999999999`
   - 密码: `testpass123`
   - 点击"登录"按钮
   - 等待自动跳转到文件管理页面

3. **注册新用户（可选）**
   - 输入新手机号（例如：`13777777777`）
   - 点击"发送验证码"
   - 输入验证码：`123456`（开发环境固定）
   - 输入密码（至少6位）
   - 点击"注册"

---

### 方法二：使用标准登录页面

1. **打开登录页面**
   ```
   http://localhost:5174/auth.html
   ```

2. **填写登录信息**
   - 手机号: `13999999999`
   - 密码: `testpass123`
   - 验证码: 随便输入（或刷新验证码后输入显示的内容）
   - 点击"登录"

3. **跳转到控制台**
   - 登录成功后自动跳转到 `console.html`
   - 点击左侧导航"文件管理"进入文件系统

---

## 🎯 文件管理功能测试清单

### 1. 界面显示测试 ✅

访问 http://localhost:5174/files.html

**检查项**:
- [ ] 左侧边栏显示用户信息（用户名：testuser2025，手机号：13999999999）
- [ ] 左侧显示"我的盘符"区域
- [ ] 盘符列表显示"默认盘"
- [ ] 顶部工具栏显示所有按钮（新建文件夹、上传、下载等）
- [ ] 右侧显示空状态提示："请选择一个盘符或文件夹"

### 2. 盘符操作测试 ✅

**测试步骤**:
1. 点击左侧的"默认盘"
2. 观察右侧是否加载文件列表
3. 面包屑导航是否显示当前路径
4. 左侧盘符是否高亮选中

**预期结果**:
- 盘符被选中（蓝色高亮）
- 面包屑显示："默认盘 /"
- 文件列表加载（可能为空）

### 3. 文件列表测试 ✅

**测试步骤**:
1. 在列表视图和网格视图之间切换
2. 点击"网格视图"按钮
3. 再点击"列表视图"按钮

**预期结果**:
- 视图成功切换
- 按钮状态正确显示（active 状态）
- 文件显示方式改变

### 4. 新建文件夹测试 ✅

**测试步骤**:
1. 确保已选择盘符
2. 点击"新建文件夹"按钮
3. 在弹出框输入文件夹名称（例如："测试文件夹"）
4. 确认创建

**预期结果**:
- 弹出输入框
- 输入后文件夹被创建
- 文件列表刷新，显示新文件夹
- 显示成功提示

### 5. 文件选择测试 ✅

**测试步骤**:
1. 点击文件/文件夹（单选）
2. Ctrl/Cmd + 点击多个文件（多选）
3. 观察选中状态

**预期结果**:
- 选中的文件显示蓝色高亮边框
- 工具栏按钮状态改变（下载、删除、重命名启用）
- 多选时可以同时选中多个

### 6. 双击打开测试 ✅

**测试步骤**:
1. 双击文件夹
2. 观察是否进入文件夹

**预期结果**:
- 进入文件夹
- 面包屑导航更新路径
- 文件列表显示子文件夹内容

### 7. 右键菜单测试 ✅

**测试步骤**:
1. 右键点击文件/文件夹
2. 观察菜单项

**预期结果**:
- 显示右键菜单
- 菜单包含：打开、下载、重命名、移动、复制、分享、预览、删除、属性
- 点击其他地方菜单消失

### 8. 面包屑导航测试 ✅

**测试步骤**:
1. 进入多层文件夹
2. 点击面包屑中的上级路径

**预期结果**:
- 返回到点击的路径
- 文件列表更新
- 面包屑正确显示当前路径

### 9. 搜索功能测试 ✅

**测试步骤**:
1. 在搜索框输入关键词
2. 等待 300ms（防抖）
3. 观察搜索结果

**预期结果**:
- 显示匹配的文件
- 搜索结果实时更新

### 10. 刷新功能测试 ✅

**测试步骤**:
1. 点击"刷新"按钮

**预期结果**:
- 文件列表重新加载
- 显示最新数据

---

## 🐛 已知问题和解决方案

### 问题1: "服务不可用"提示

**原因**: 前端登录页面的错误处理逻辑会将部分后端错误误判为服务器错误

**解决方案**: 使用测试页面 `test-auth.html` 进行登录

### 问题2: 盘符列表为空

**原因**: 用户没有创建虚拟盘符

**解决方案**:
- 后端会自动为新用户创建默认盘符
- 如果没有，可以手动创建

### 问题3: 文件列表加载失败

**原因**:
- 后端 API 可能尚未完全实现
- 数据库中没有文件数据

**解决方案**:
- 检查后端 `/api/v1/files` 接口是否正常
- 查看浏览器 Console 和 Network 的错误信息

---

## 🔍 调试技巧

### 1. 查看 Console 日志

打开浏览器开发者工具（F12），查看 Console 标签页：
```javascript
// 文件管理器会输出以下日志:
- "File manager initialized successfully"
- "User info loaded: {...}"
- "Loaded X drives"
- "Loaded X files from /path"
```

### 2. 查看 Network 请求

在 Network 标签页筛选 XHR 请求，查看：
- 请求 URL
- 请求参数
- 响应数据
- HTTP 状态码

### 3. 查看 LocalStorage

在 Application 标签页 → Local Storage：
```
access_token: eyJhbGci...  (JWT token)
refresh_token: eyJhbGci... (刷新 token)
user_info: {"username":"testuser2025",...}
```

---

## 📊 API 端点测试

### 使用 curl 测试后端接口

```bash
# 1. 登录获取 token
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser2025","password":"testpass123"}'

# 2. 获取盘符列表（需要 token）
curl -X GET http://localhost:8000/api/v1/drives \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 3. 获取文件列表
curl -X GET "http://localhost:8000/api/v1/files?drive_id=DRIVE_ID&folder_path=/" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 4. 创建文件夹
curl -X POST http://localhost:8000/api/v1/files \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "drive_id": "DRIVE_ID",
    "folder_path": "/",
    "file_name": "新文件夹",
    "is_folder": true
  }'
```

---

## ✅ 测试通过标准

所有测试项都应该满足以下条件：
1. 无 JavaScript 错误（Console 无报错）
2. API 请求成功（Network 显示 200 状态码）
3. UI 响应正常（按钮可点击，数据正常显示）
4. 用户体验流畅（加载状态、错误提示清晰）

---

## 📞 获取帮助

如果遇到问题：
1. 查看浏览器 Console 错误信息
2. 查看 Network 请求详情
3. 检查后端服务日志
4. 查看数据库数据是否正确

**测试愉快！** 🚀
